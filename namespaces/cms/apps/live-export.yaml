apiVersion: v1
items:
- apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: '{"apiVersion":"networking.k8s.io/v1","kind":"Ingress","metadata":{"annotations":{"nginx.ingress.kubernetes.io/proxy-body-size":"64m"},"name":"wordpress","namespace":"cms"},"spec":{"ingressClassName":"nginx","rules":[{"host":"cms.thealgoera.com","http":{"paths":[{"backend":{"service":{"name":"wordpress","port":{"number":80}}},"path":"/","pathType":"Prefix"}]}}]}}

        '
      nginx.ingress.kubernetes.io/proxy-body-size: 64m
    creationTimestamp: '2026-02-06T05:15:21Z'
    generation: 1
    name: wordpress
    namespace: cms
    resourceVersion: '98951'
    uid: f55674cb-9656-4807-8f4c-db5c85d3f315
  spec:
    ingressClassName: nginx
    rules:
    - host: cms.thealgoera.com
      http:
        paths:
        - backend:
            service:
              name: wordpress
              port:
                number: 80
          path: /
          pathType: Prefix
  status:
    loadBalancer:
      ingress:
      - ip: 10.43.45.99
- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: '{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{},"name":"cms-backups-pvc","namespace":"cms"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"50Gi"}},"storageClassName":"local-path"}}

        '
      pv.kubernetes.io/bind-completed: 'yes'
      pv.kubernetes.io/bound-by-controller: 'yes'
      volume.beta.kubernetes.io/storage-provisioner: rancher.io/local-path
      volume.kubernetes.io/selected-node: k3s-w3
      volume.kubernetes.io/storage-provisioner: rancher.io/local-path
    creationTimestamp: '2026-02-07T05:19:24Z'
    finalizers:
    - kubernetes.io/pvc-protection
    name: cms-backups-pvc
    namespace: cms
    resourceVersion: '160957'
    uid: 5893c4ba-9bb9-4163-b9ad-471754fffd85
  spec:
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: 50Gi
    storageClassName: local-path
    volumeMode: Filesystem
    volumeName: pvc-5893c4ba-9bb9-4163-b9ad-471754fffd85
  status:
    accessModes:
    - ReadWriteOnce
    capacity:
      storage: 50Gi
    phase: Bound
- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: '{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{},"name":"cms-backups-wp-pvc","namespace":"cms"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"50Gi"}},"storageClassName":"local-path"}}

        '
      pv.kubernetes.io/bind-completed: 'yes'
      pv.kubernetes.io/bound-by-controller: 'yes'
      volume.beta.kubernetes.io/storage-provisioner: rancher.io/local-path
      volume.kubernetes.io/selected-node: k3s-w1
      volume.kubernetes.io/storage-provisioner: rancher.io/local-path
    creationTimestamp: '2026-02-07T05:21:29Z'
    finalizers:
    - kubernetes.io/pvc-protection
    name: cms-backups-wp-pvc
    namespace: cms
    resourceVersion: '161150'
    uid: 09fd2448-424e-4816-a1bd-8dee75e696e1
  spec:
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: 50Gi
    storageClassName: local-path
    volumeMode: Filesystem
    volumeName: pvc-09fd2448-424e-4816-a1bd-8dee75e696e1
  status:
    accessModes:
    - ReadWriteOnce
    capacity:
      storage: 50Gi
    phase: Bound
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: '{"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"mariadb-backup","namespace":"cms"},"spec":{"failedJobsHistoryLimit":3,"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"command":["/bin/bash","-ec","TS=$(date
        +%F_%H%M)\nOUTDIR=/backups/db\nmkdir -p \"${OUTDIR}\"\nmariadb-dump -h \"${DB_HOST}\"
        -u \"${DB_USER}\" -p\"${DB_PASS}\" \"${DB_NAME}\" \\\n  | gzip \u003e \"${OUTDIR}/wordpress_${TS}.sql.gz\"\nfind
        \"${OUTDIR}\" -type f -mtime +14 -name \"*.sql.gz\" -delete\n"],"env":[{"name":"DB_HOST","value":"mariadb.cms.svc.cluster.local"},{"name":"DB_NAME","value":"wordpress"},{"name":"DB_USER","value":"dustin"},{"name":"DB_PASS","valueFrom":{"secretKeyRef":{"key":"mariadb-password","name":"mariadb"}}}],"image":"bitnami/mariadb:latest","name":"mariadb-backup","volumeMounts":[{"mountPath":"/backups","name":"backups"}]}],"nodeSelector":{"kubernetes.io/hostname":"k3s-w3"},"restartPolicy":"OnFailure","volumes":[{"name":"backups","persistentVolumeClaim":{"claimName":"cms-backups-pvc"}}]}}}},"schedule":"0
        2 * * *","successfulJobsHistoryLimit":3}}

        '
    creationTimestamp: '2026-02-07T05:19:24Z'
    generation: 2
    name: mariadb-backup
    namespace: cms
    resourceVersion: '313058'
    uid: d5eb7942-37f8-49ee-a378-99ab2edbe3d6
  spec:
    concurrencyPolicy: Allow
    failedJobsHistoryLimit: 3
    jobTemplate:
      metadata: {}
      spec:
        template:
          metadata: {}
          spec:
            containers:
            - command:
              - /bin/bash
              - -ec
              - "TS=$(date +%F_%H%M)\nOUTDIR=/backups/db\nmkdir -p \"${OUTDIR}\"\n\
                mariadb-dump -h \"${DB_HOST}\" -u \"${DB_USER}\" -p\"${DB_PASS}\"\
                \ \"${DB_NAME}\" \\\n  | gzip > \"${OUTDIR}/wordpress_${TS}.sql.gz\"\
                \nfind \"${OUTDIR}\" -type f -mtime +14 -name \"*.sql.gz\" -delete\n"
              env:
              - name: DB_HOST
                value: mariadb.cms.svc.cluster.local
              - name: DB_NAME
                value: wordpress
              - name: DB_USER
                value: dustin
              - name: DB_PASS
                valueFrom:
                  secretKeyRef:
                    key: mariadb-password
                    name: mariadb
              image: bitnami/mariadb:latest
              imagePullPolicy: IfNotPresent
              name: mariadb-backup
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
              - mountPath: /backups
                name: backups
            dnsPolicy: ClusterFirst
            nodeSelector:
              kubernetes.io/hostname: k3s-w3
            restartPolicy: OnFailure
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
            - name: backups
              persistentVolumeClaim:
                claimName: cms-backups-pvc
    schedule: 0 2 * * *
    successfulJobsHistoryLimit: 3
    suspend: false
  status:
    lastScheduleTime: '2026-02-09T02:00:00Z'
    lastSuccessfulTime: '2026-02-09T02:00:04Z'
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: '{"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"mariadb-restore-test","namespace":"cms"},"spec":{"concurrencyPolicy":"Forbid","failedJobsHistoryLimit":3,"jobTemplate":{"spec":{"backoffLimit":0,"template":{"spec":{"containers":[{"command":["/bin/bash","-ec","latest_file=$(ls
        -t /backups/db/*.sql.gz | head -n 1)\nif [ -z \"$latest_file\" ]; then\n  echo
        \"No backup files found in /backups/db\" \u003e\u00262\n  exit 1\nfi\necho
        \"Using backup: $latest_file\"\n\nmariadb -h mariadb.cms.svc.cluster.local
        -u root -p\"$MARIADB_ROOT_PASSWORD\" -e \"DROP DATABASE IF EXISTS wordpress_restore_test;
        CREATE DATABASE wordpress_restore_test;\"\ngunzip -c \"$latest_file\" | mariadb
        -h mariadb.cms.svc.cluster.local -u root -p\"$MARIADB_ROOT_PASSWORD\" wordpress_restore_test\n\nmariadb
        -h mariadb.cms.svc.cluster.local -u root -p\"$MARIADB_ROOT_PASSWORD\" -e \"SELECT
        COUNT(*) AS tables_count FROM information_schema.tables WHERE table_schema=''wordpress_restore_test'';\"\nmariadb
        -h mariadb.cms.svc.cluster.local -u root -p\"$MARIADB_ROOT_PASSWORD\" -e \"DROP
        DATABASE IF EXISTS wordpress_restore_test;\"\n"],"env":[{"name":"MARIADB_ROOT_PASSWORD","valueFrom":{"secretKeyRef":{"key":"mariadb-root-password","name":"mariadb"}}}],"image":"bitnami/mariadb:latest","imagePullPolicy":"IfNotPresent","name":"restore-test","volumeMounts":[{"mountPath":"/backups","name":"backups"}]}],"nodeSelector":{"kubernetes.io/hostname":"k3s-w3"},"restartPolicy":"Never","volumes":[{"name":"backups","persistentVolumeClaim":{"claimName":"cms-backups-pvc"}}]}}}},"schedule":"30
        3 * * 0","successfulJobsHistoryLimit":1}}

        '
    creationTimestamp: '2026-02-07T17:14:46Z'
    generation: 1
    name: mariadb-restore-test
    namespace: cms
    resourceVersion: '236026'
    uid: 5f8f56fd-03af-4afa-924c-ba8ccaf0656e
  spec:
    concurrencyPolicy: Forbid
    failedJobsHistoryLimit: 3
    jobTemplate:
      metadata: {}
      spec:
        backoffLimit: 0
        template:
          metadata: {}
          spec:
            containers:
            - command:
              - /bin/bash
              - -ec
              - "latest_file=$(ls -t /backups/db/*.sql.gz | head -n 1)\nif [ -z \"\
                $latest_file\" ]; then\n  echo \"No backup files found in /backups/db\"\
                \ >&2\n  exit 1\nfi\necho \"Using backup: $latest_file\"\n\nmariadb\
                \ -h mariadb.cms.svc.cluster.local -u root -p\"$MARIADB_ROOT_PASSWORD\"\
                \ -e \"DROP DATABASE IF EXISTS wordpress_restore_test; CREATE DATABASE\
                \ wordpress_restore_test;\"\ngunzip -c \"$latest_file\" | mariadb\
                \ -h mariadb.cms.svc.cluster.local -u root -p\"$MARIADB_ROOT_PASSWORD\"\
                \ wordpress_restore_test\n\nmariadb -h mariadb.cms.svc.cluster.local\
                \ -u root -p\"$MARIADB_ROOT_PASSWORD\" -e \"SELECT COUNT(*) AS tables_count\
                \ FROM information_schema.tables WHERE table_schema='wordpress_restore_test';\"\
                \nmariadb -h mariadb.cms.svc.cluster.local -u root -p\"$MARIADB_ROOT_PASSWORD\"\
                \ -e \"DROP DATABASE IF EXISTS wordpress_restore_test;\"\n"
              env:
              - name: MARIADB_ROOT_PASSWORD
                valueFrom:
                  secretKeyRef:
                    key: mariadb-root-password
                    name: mariadb
              image: bitnami/mariadb:latest
              imagePullPolicy: IfNotPresent
              name: restore-test
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
              - mountPath: /backups
                name: backups
            dnsPolicy: ClusterFirst
            nodeSelector:
              kubernetes.io/hostname: k3s-w3
            restartPolicy: Never
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
            - name: backups
              persistentVolumeClaim:
                claimName: cms-backups-pvc
    schedule: 30 3 * * 0
    successfulJobsHistoryLimit: 1
    suspend: false
  status:
    lastScheduleTime: '2026-02-08T03:30:00Z'
    lastSuccessfulTime: '2026-02-08T03:30:06Z'
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: '{"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"wordpress-backup","namespace":"cms"},"spec":{"failedJobsHistoryLimit":3,"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"command":["/bin/sh","-ec","TS=$(date
        +%F_%H%M)\nOUTDIR=/backups/wp\nmkdir -p \"${OUTDIR}\"\ntar -czf \"${OUTDIR}/wp-content_${TS}.tar.gz\"
        -C /source wp-content\nfind \"${OUTDIR}\" -type f -mtime +14 -name \"*.tar.gz\"
        -delete\n"],"image":"alpine:3.20","name":"wordpress-backup","volumeMounts":[{"mountPath":"/source","name":"wordpress-data","readOnly":true,"subPath":"wordpress"},{"mountPath":"/backups","name":"backups"}]}],"nodeSelector":{"kubernetes.io/hostname":"k3s-w1"},"restartPolicy":"OnFailure","volumes":[{"name":"wordpress-data","persistentVolumeClaim":{"claimName":"wordpress"}},{"name":"backups","persistentVolumeClaim":{"claimName":"cms-backups-wp-pvc"}}]}}}},"schedule":"15
        2 * * *","successfulJobsHistoryLimit":3}}

        '
    creationTimestamp: '2026-02-07T05:19:24Z'
    generation: 3
    name: wordpress-backup
    namespace: cms
    resourceVersion: '232190'
    uid: cac472ff-724b-4431-9d48-640323b16b75
  spec:
    concurrencyPolicy: Allow
    failedJobsHistoryLimit: 3
    jobTemplate:
      metadata: {}
      spec:
        template:
          metadata: {}
          spec:
            containers:
            - command:
              - /bin/sh
              - -ec
              - 'TS=$(date +%F_%H%M)

                OUTDIR=/backups/wp

                mkdir -p "${OUTDIR}"

                tar -czf "${OUTDIR}/wp-content_${TS}.tar.gz" -C /source wp-content

                find "${OUTDIR}" -type f -mtime +14 -name "*.tar.gz" -delete

                '
              image: alpine:3.20
              imagePullPolicy: IfNotPresent
              name: wordpress-backup
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
              - mountPath: /source
                name: wordpress-data
                readOnly: true
                subPath: wordpress
              - mountPath: /backups
                name: backups
            dnsPolicy: ClusterFirst
            nodeSelector:
              kubernetes.io/hostname: k3s-w1
            restartPolicy: OnFailure
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
            - name: wordpress-data
              persistentVolumeClaim:
                claimName: wordpress
            - name: backups
              persistentVolumeClaim:
                claimName: cms-backups-wp-pvc
    schedule: 15 2 * * *
    successfulJobsHistoryLimit: 3
    suspend: false
  status:
    lastScheduleTime: '2026-02-08T02:15:00Z'
    lastSuccessfulTime: '2026-02-08T02:15:04Z'
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: '{"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"wp-cron","namespace":"cms"},"spec":{"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"args":["/bin/sh","-ec","curl
        -fsS https://cms.thealgoera.com/wp-cron.php?doing_wp_cron \u003e /dev/null\n"],"image":"curlimages/curl:8.7.1","name":"wp-cron"}],"restartPolicy":"OnFailure"}}}},"schedule":"*/5
        * * * *"}}

        '
    creationTimestamp: '2026-02-07T04:48:48Z'
    generation: 2
    name: wp-cron
    namespace: cms
    resourceVersion: '313047'
    uid: 007a37d0-b0cb-4c76-b22e-f4eb3c87af28
  spec:
    concurrencyPolicy: Allow
    failedJobsHistoryLimit: 1
    jobTemplate:
      metadata: {}
      spec:
        template:
          metadata: {}
          spec:
            containers:
            - args:
              - /bin/sh
              - -ec
              - curl -fsS http://wordpress.cms.svc.cluster.local/wp-cron.php?doing_wp_cron
                > /dev/null
              image: curlimages/curl:8.7.1
              imagePullPolicy: IfNotPresent
              name: wp-cron
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
            dnsPolicy: ClusterFirst
            restartPolicy: OnFailure
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
    schedule: '*/5 * * * *'
    successfulJobsHistoryLimit: 3
    suspend: false
  status:
    lastScheduleTime: '2026-02-09T02:00:00Z'
    lastSuccessfulTime: '2026-02-09T02:00:03Z'
